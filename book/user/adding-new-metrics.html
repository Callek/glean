<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Adding new metrics - Glean - Cross-platform Telemetry library</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="../tabs.css">
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li><a href="../index.html"><strong aria-hidden="true">1.</strong> Glean</a></li><li><a href="../user/index.html"><strong aria-hidden="true">2.</strong> Using the Glean SDK</a></li><li><ol class="section"><li><a href="../user/adding-glean-to-your-project.html"><strong aria-hidden="true">2.1.</strong> Adding Glean to your project</a></li><li><a href="../user/general-api.html"><strong aria-hidden="true">2.2.</strong> The General API</a></li><li><a href="../user/adding-new-metrics.html" class="active"><strong aria-hidden="true">2.3.</strong> Adding new metrics</a></li><li><a href="../user/metric-parameters.html"><strong aria-hidden="true">2.4.</strong> Metric parameters</a></li><li><a href="../user/testing-metrics.html"><strong aria-hidden="true">2.5.</strong> Testing metrics</a></li><li><a href="../user/debugging/index.html"><strong aria-hidden="true">2.6.</strong> Debugging products using Glean</a></li><li><ol class="section"><li><a href="../user/debugging/android.html"><strong aria-hidden="true">2.6.1.</strong> Android</a></li><li><a href="../user/debugging/ios.html"><strong aria-hidden="true">2.6.2.</strong> iOS</a></li></ol></li><li><a href="../user/error-reporting.html"><strong aria-hidden="true">2.7.</strong> Error reporting</a></li><li><a href="../user/experiments-api.html"><strong aria-hidden="true">2.8.</strong> Using the experiments API</a></li><li><a href="../user/metrics/index.html"><strong aria-hidden="true">2.9.</strong> Metric types</a></li><li><ol class="section"><li><a href="../user/metrics/boolean.html"><strong aria-hidden="true">2.9.1.</strong> Boolean</a></li><li><a href="../user/metrics/counter.html"><strong aria-hidden="true">2.9.2.</strong> Counter</a></li><li><a href="../user/metrics/labeled_counters.html"><strong aria-hidden="true">2.9.3.</strong> Labeled Counters</a></li><li><a href="../user/metrics/string.html"><strong aria-hidden="true">2.9.4.</strong> String</a></li><li><a href="../user/metrics/labeled_strings.html"><strong aria-hidden="true">2.9.5.</strong> Labeled Strings</a></li><li><a href="../user/metrics/string_list.html"><strong aria-hidden="true">2.9.6.</strong> String List</a></li><li><a href="../user/metrics/timespan.html"><strong aria-hidden="true">2.9.7.</strong> Timespan</a></li><li><a href="../user/metrics/timing_distribution.html"><strong aria-hidden="true">2.9.8.</strong> Timing Distribution</a></li><li><a href="../user/metrics/memory_distribution.html"><strong aria-hidden="true">2.9.9.</strong> Memory Distribution</a></li><li><a href="../user/metrics/uuid.html"><strong aria-hidden="true">2.9.10.</strong> UUID</a></li><li><a href="../user/metrics/datetime.html"><strong aria-hidden="true">2.9.11.</strong> Datetime</a></li><li><a href="../user/metrics/event.html"><strong aria-hidden="true">2.9.12.</strong> Event</a></li><li><a href="../user/metrics/custom_distribution.html"><strong aria-hidden="true">2.9.13.</strong> Custom Distribution</a></li><li><a href="../user/metrics/quantity.html"><strong aria-hidden="true">2.9.14.</strong> Quantity</a></li></ol></li><li><a href="../user/pings/index.html"><strong aria-hidden="true">2.10.</strong> Pings</a></li><li><ol class="section"><li><a href="../user/pings/baseline.html"><strong aria-hidden="true">2.10.1.</strong> Baseline Ping</a></li><li><a href="../user/pings/deletion_request.html"><strong aria-hidden="true">2.10.2.</strong> Deletion Request Ping</a></li><li><a href="../user/pings/metrics.html"><strong aria-hidden="true">2.10.3.</strong> Metrics Ping</a></li><li><a href="../user/pings/events.html"><strong aria-hidden="true">2.10.4.</strong> Events Ping</a></li><li><a href="../user/pings/custom.html"><strong aria-hidden="true">2.10.5.</strong> Custom Pings</a></li><li><a href="../user/pings/testing-custom-pings.html"><strong aria-hidden="true">2.10.6.</strong> Testing custom pings</a></li></ol></li><li><a href="../user/android-build-configuration-options.html"><strong aria-hidden="true">2.11.</strong> Android build configuration options</a></li><li><a href="../user/focused-use-cases.html"><strong aria-hidden="true">2.12.</strong> Focused Use Cases</a></li><li><ol class="section"><li><a href="../user/instrument-android-crashes-example.html"><strong aria-hidden="true">2.12.1.</strong> Instrumenting Android Crashes With Glean</a></li></ol></li></ol></li><li><a href="../user/collected-metrics/metrics.html"><strong aria-hidden="true">3.</strong> Metrics collected by the Glean SDK</a></li><li><a href="../dev/index.html"><strong aria-hidden="true">4.</strong> Developing the Glean SDK</a></li><li><ol class="section"><li><a href="../dev/testing.html"><strong aria-hidden="true">4.1.</strong> Testing</a></li><li><a href="../dev/android/index.html"><strong aria-hidden="true">4.2.</strong> Android bindings</a></li><li><ol class="section"><li><a href="../dev/android/setup-android-build-environment.html"><strong aria-hidden="true">4.2.1.</strong> Setup Build Environment</a></li></ol></li><li><a href="../dev/ios/index.html"><strong aria-hidden="true">4.3.</strong> iOS bindings</a></li><li><ol class="section"><li><a href="../dev/ios/setup-ios-build-environment.html"><strong aria-hidden="true">4.3.1.</strong> Setup Build Environment</a></li><li><a href="../dev/ios/debug-glean-on-ios.html"><strong aria-hidden="true">4.3.2.</strong> Debugging Different Versions of Glean</a></li></ol></li><li><a href="../dev/python/index.html"><strong aria-hidden="true">4.4.</strong> Python bindings</a></li><li><ol class="section"><li><a href="../dev/python/setting-up-python-build-environment.html"><strong aria-hidden="true">4.4.1.</strong> Setup Build Environment</a></li></ol></li><li><a href="../dev/core/index.html"><strong aria-hidden="true">4.5.</strong> Rust Component</a></li><li><ol class="section"><li><a href="../dev/core/dependency-management.html"><strong aria-hidden="true">4.5.1.</strong> Dependency Management</a></li><li><a href="../dev/core/new-metric-type.html"><strong aria-hidden="true">4.5.2.</strong> Adding a new metric type</a></li><li><ol class="section"><li><a href="../dev/core/new-metric-type/ffi.html"><strong aria-hidden="true">4.5.2.1.</strong> FFI</a></li><li><a href="../dev/core/new-metric-type/kotlin.html"><strong aria-hidden="true">4.5.2.2.</strong> Kotlin</a></li><li><a href="../dev/core/new-metric-type/swift.html"><strong aria-hidden="true">4.5.2.3.</strong> Swift</a></li></ol></li></ol></li><li><a href="../dev/ffi/index.html"><strong aria-hidden="true">4.6.</strong> FFI Layer</a></li><li><ol class="section"><li><a href="../dev/ffi/when-to-use-what-in-the-ffi.html"><strong aria-hidden="true">4.6.1.</strong> When/How FFI</a></li></ol></li><li><a href="../dev/cut-a-new-release.html"><strong aria-hidden="true">4.7.</strong> Release process</a></li><li><a href="../contributing.html"><strong aria-hidden="true">4.8.</strong> Contributing</a></li><li><ol class="section"><li><a href="../code_coverage.html"><strong aria-hidden="true">4.8.1.</strong> Code coverage</a></li></ol></li><li><a href="../dev/core/internal/index.html"><strong aria-hidden="true">4.9.</strong> Internal implementation details</a></li><li><ol class="section"><li><a href="../dev/core/internal/reserved-ping-names.html"><strong aria-hidden="true">4.9.1.</strong> Reserved ping names</a></li><li><a href="../dev/core/internal/clearing.html"><strong aria-hidden="true">4.9.2.</strong> Clearing metrics when disabling/enabling Glean</a></li><li><a href="../dev/core/internal/payload.html"><strong aria-hidden="true">4.9.3.</strong> Payload format</a></li><li><a href="../dev/core/internal/directory-structure.html"><strong aria-hidden="true">4.9.4.</strong> Directory structure</a></li><li><a href="../dev/core/internal/debug-pings.html"><strong aria-hidden="true">4.9.5.</strong> Debug Pings</a></li></ol></li><li><a href="../dev/howtos/index.html"><strong aria-hidden="true">4.10.</strong> Howtos</a></li><li><ol class="section"><li><a href="../dev/howtos/development-with-android-components.html"><strong aria-hidden="true">4.10.1.</strong> Development with android-components</a></li><li><a href="../dev/howtos/locally-published-components-in-fenix.html"><strong aria-hidden="true">4.10.2.</strong> Locally-published components in Fenix</a></li></ol></li></ol></li><li><a href="../api/index.html"><strong aria-hidden="true">5.</strong> API Documentation</a></li><li><a href="../appendix/index.html"><strong aria-hidden="true">6.</strong> Appendix</a></li><li><ol class="section"><li><a href="../appendix/changelog.html"><strong aria-hidden="true">6.1.</strong> Changelog</a></li><li><a href="../appendix/twig.html"><strong aria-hidden="true">6.2.</strong> This Week in Glean</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Glean - Cross-platform Telemetry library</h1>

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#adding-new-metrics" id="adding-new-metrics">Adding new metrics</a></h1>
<p>All metrics that your project collects must be defined in a <code>metrics.yaml</code> file.
This file should be at the root of the application or library module.
The format of that file is documented <a href="https://mozilla.github.io/glean_parser/metrics-yaml.html">here</a>.</p>
<p>When adding a new metric, the workflow is:</p>
<ul>
<li>Decide on which <a href="metrics/index.html">metric type</a> you want to use.</li>
<li>Add a new entry to <a href="#The-metricsyaml-file"><code>metrics.yaml</code></a>.</li>
<li>Add code to your project to record into the metric by calling the Glean SDK.</li>
</ul>
<blockquote>
<p><strong>Important</strong>: Any new data collection requires documentation and data-review.
This is also required for any new metric automatically collected by the Glean SDK.</p>
</blockquote>
<h2><a class="header" href="#the-metricsyaml-file" id="the-metricsyaml-file">The <code>metrics.yaml</code> file</a></h2>
<p>The <code>metrics.yaml</code> file defines the metrics your application or library will send.
They are organized into categories.
The overall organization is:</p>
<pre><code class="language-YAML"># Required to indicate this is a `metrics.yaml` file
$schema: moz://mozilla.org/schemas/glean/metrics/1-0-0

toolbar:
  click:
    type: event
    description: |
      Event to record toolbar clicks.
    notification_emails:
      - CHANGE-ME@example.com
    bugs:
      - 123456789
    data_reviews:
      - http://example.com/path/to/data-review
    expires: 2019-06-01  # &lt;-- Update to a date in the future

  double_click:
    ...

category2.subcategory:  # Categories can contain subcategories
  metric:
    ...

</code></pre>
<p>The details of the metric parameters are described in <a href="metric-parameters.html">metric parameters</a>.</p>
<p>The <code>metrics.yaml</code> file is used to generate code in the target language (e.g. Kotlin, Swift, ...) that becomes the public API to access your application's metrics.</p>
<h2><a class="header" href="#recommendations-for-defining-new-metrics" id="recommendations-for-defining-new-metrics">Recommendations for defining new metrics</a></h2>
<p>“There are only two hard things in Computer Science: cache invalidation and naming things” -- attributed to Phil Karlton.</p>
<h3><a class="header" href="#lifetimes" id="lifetimes">Lifetimes</a></h3>
<p>The <code>lifetime</code> parameter of a metric defines when it will be reset. There are three options available:</p>
<ul>
<li><code>ping</code> (default): The metric is reset each time it is sent in the ping.
This is the most common case, and should be used for metrics that are highly dynamic, such as things computed in response to the user's interaction with the application.</li>
<li><code>application</code>: The metric is related to an application run, and is reset only when the application restarts.
This should be used for things that are constant during the run of an application, such as the operating system version.
In practice, these metrics are generally set during application startup.
A common mistake---using the <code>ping</code> lifetime for these type of metrics---means that they will only be included in the first ping sent during a particular run of the application.</li>
<li><code>user</code>: The metric is part of the user's profile.
This should be used for things that change only when the user's profile is created.
It is rare to use this lifetime outside of some metrics that are built in to Glean, such as <code>client_id</code>.</li>
</ul>
<h3><a class="header" href="#naming-things" id="naming-things">Naming things</a></h3>
<p>Metric identifiers (the combination of a metric's category and name) must be unique across all metrics that are sent by an application.
This includes not only the metrics defined in the app's <code>metrics.yaml</code>, but the <code>metrics.yaml</code> of any Glean-using library that the application uses, including Glean itself.
Therefore, care should be taken to name things specifically enough so as to avoid namespace collisions.
In practice, this generally involves thinking carefully about the <code>category</code> of the metric, more than the <code>name</code>.</p>
<blockquote>
<p><strong>Note:</strong> Duplicate metric identifiers are not currently detected at build time. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1578383">bug 1578383</a> for progress on that.
However, the <a href="https://github.com/mozilla/probe-scraper">probe_scraper</a> process, which runs nightly, will detect duplicate metrics and e-mail the <code>notification_emails</code> associated with the given metrics.</p>
</blockquote>
<p>More broadly, you should choose the category and names of metrics to be as specific as possible.
It is not necessary to put the type of the metric in the category or name, since this information is retained in other ways through the entire end-to-end system.</p>
<p>For example, if defining a set of events related to search, put them in a category called <code>search</code>, rather than just <code>events</code> or <code>search_events</code>.</p>
<h3><a class="header" href="#expiration" id="expiration">Expiration</a></h3>
<p>You should think carefully about how long the metric will be needed, and set it to expire at the soonest time possible.
When a metric is about to expire, emails will be sent to the <code>notification_emails</code> addresses associated with the metric.
At that time, the metric should be removed, which involves removing it from the <code>metrics.yaml</code> file and removing uses of it in the source code.
Removing a metric does not affect the availability of data already collected by the pipeline.</p>
<p>If the metric is still needed, it should go back for <a href="https://wiki.mozilla.org/Firefox/Data_Collection">another round of data review</a> to have its expiration date extended.</p>
<h2><a class="header" href="#a-note-about-case-inflection" id="a-note-about-case-inflection">A note about case inflection</a></h2>
<div class="tabs">
<div class="tabbar"></div>
<div class="tabcontents">
<div data-lang="Kotlin" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>,
but given the Kotlin coding standards defined by <a href="https://github.com/pinterest/ktlint">ktlint</a>,
these identifiers must be <code>camelCase</code> in Kotlin.
For example, the metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">views:
  login_opened:
    ...
</code></pre>
<p>is accessible in Kotlin as:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.Views
GleanMetrics.Views.loginOpened...
</code></pre>
</div>
<div data-lang="Swift" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>,
but given the Swift coding standards defined by <a href="https://github.com/realm/SwiftLint">swiftlint</a>,
these identifiers must be <code>camelCase</code> in Swift.
For example, the metric defined in the <code>metrics.yaml</code> as:</p>
<pre><code class="language-YAML">views:
  login_opened:
    ...
</code></pre>
<p>is accessible in Kotlin as:</p>
<pre><code class="language-Swift">GleanMetrics.Views.loginOpened...
</code></pre>
</div>
<div data-lang="Python" class="tab">
<p>Category and metric names in the <code>metrics.yaml</code> are in <code>snake_case</code>, which matches the <a href="https://www.python.org/dev/peps/pep-0008/">PEP8</a> standard, so no translation is needed for Python.</p>
</div>
</div>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../user/general-api.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../user/metric-parameters.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../user/general-api.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../user/metric-parameters.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="../tabs.js"></script>
        

        

    </body>
</html>
