<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Using the experiments API - Glean - Cross-platform Telemetry library</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="../tabs.css">
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li><a href="../index.html"><strong aria-hidden="true">1.</strong> Glean</a></li><li><a href="../user/index.html"><strong aria-hidden="true">2.</strong> Using the Glean SDK</a></li><li><ol class="section"><li><a href="../user/adding-glean-to-your-project.html"><strong aria-hidden="true">2.1.</strong> Adding Glean to your project</a></li><li><a href="../user/adding-new-metrics.html"><strong aria-hidden="true">2.2.</strong> Adding new metrics</a></li><li><a href="../user/metric-parameters.html"><strong aria-hidden="true">2.3.</strong> Metric parameters</a></li><li><a href="../user/testing-metrics.html"><strong aria-hidden="true">2.4.</strong> Testing metrics</a></li><li><a href="../user/debugging.html"><strong aria-hidden="true">2.5.</strong> Debugging products using Glean</a></li><li><a href="../user/error-reporting.html"><strong aria-hidden="true">2.6.</strong> Error reporting</a></li><li><a href="../user/experiments-api.html" class="active"><strong aria-hidden="true">2.7.</strong> Using the experiments API</a></li><li><a href="../user/metrics/index.html"><strong aria-hidden="true">2.8.</strong> Metric types</a></li><li><ol class="section"><li><a href="../user/metrics/boolean.html"><strong aria-hidden="true">2.8.1.</strong> Boolean</a></li><li><a href="../user/metrics/counter.html"><strong aria-hidden="true">2.8.2.</strong> Counter</a></li><li><a href="../user/metrics/labeled_counters.html"><strong aria-hidden="true">2.8.3.</strong> Labeled Counters</a></li><li><a href="../user/metrics/string.html"><strong aria-hidden="true">2.8.4.</strong> String</a></li><li><a href="../user/metrics/labeled_strings.html"><strong aria-hidden="true">2.8.5.</strong> Labeled Strings</a></li><li><a href="../user/metrics/string_list.html"><strong aria-hidden="true">2.8.6.</strong> String List</a></li><li><a href="../user/metrics/timespan.html"><strong aria-hidden="true">2.8.7.</strong> Timespan</a></li><li><a href="../user/metrics/timing_distribution.html"><strong aria-hidden="true">2.8.8.</strong> Timing Distribution</a></li><li><a href="../user/metrics/memory_distribution.html"><strong aria-hidden="true">2.8.9.</strong> Memory Distribution</a></li><li><a href="../user/metrics/uuid.html"><strong aria-hidden="true">2.8.10.</strong> UUID</a></li><li><a href="../user/metrics/datetime.html"><strong aria-hidden="true">2.8.11.</strong> Datetime</a></li><li><a href="../user/metrics/event.html"><strong aria-hidden="true">2.8.12.</strong> Event</a></li><li><a href="../user/metrics/custom_distribution.html"><strong aria-hidden="true">2.8.13.</strong> Custom Distribution</a></li><li><a href="../user/metrics/quantity.html"><strong aria-hidden="true">2.8.14.</strong> Quantity</a></li></ol></li><li><a href="../user/pings/index.html"><strong aria-hidden="true">2.9.</strong> Pings</a></li><li><ol class="section"><li><a href="../user/pings/baseline.html"><strong aria-hidden="true">2.9.1.</strong> Baseline Ping</a></li><li><a href="../user/pings/metrics.html"><strong aria-hidden="true">2.9.2.</strong> Metrics Ping</a></li><li><a href="../user/pings/events.html"><strong aria-hidden="true">2.9.3.</strong> Events Ping</a></li><li><a href="../user/pings/custom.html"><strong aria-hidden="true">2.9.4.</strong> Custom Pings</a></li><li><a href="../user/pings/testing-custom-pings.html"><strong aria-hidden="true">2.9.5.</strong> Testing custom pings</a></li></ol></li><li><a href="../user/android-build-configuration-options.html"><strong aria-hidden="true">2.10.</strong> Android build configuration options</a></li></ol></li><li><a href="../user/collected-metrics/metrics.html"><strong aria-hidden="true">3.</strong> Metrics collected by the Glean SDK</a></li><li><a href="../dev/index.html"><strong aria-hidden="true">4.</strong> Developing the Glean SDK</a></li><li><ol class="section"><li><a href="../dev/testing.html"><strong aria-hidden="true">4.1.</strong> Testing</a></li><li><a href="../dev/android/index.html"><strong aria-hidden="true">4.2.</strong> Android bindings</a></li><li><ol class="section"><li><a href="../dev/android/setup-android-build-environment.html"><strong aria-hidden="true">4.2.1.</strong> Setup Build Environment</a></li></ol></li><li><a href="../dev/ios/index.html"><strong aria-hidden="true">4.3.</strong> iOS bindings</a></li><li><ol class="section"><li><a href="../dev/ios/setup-ios-build-environment.html"><strong aria-hidden="true">4.3.1.</strong> Setup Build Environment</a></li></ol></li><li><a href="../dev/core/index.html"><strong aria-hidden="true">4.4.</strong> Rust Component</a></li><li><ol class="section"><li><a href="../dev/core/dependency-management.html"><strong aria-hidden="true">4.4.1.</strong> Dependency Management</a></li><li><a href="../dev/core/new-metric-type.html"><strong aria-hidden="true">4.4.2.</strong> Adding a new metric type</a></li><li><ol class="section"><li><a href="../dev/core/new-metric-type/ffi.html"><strong aria-hidden="true">4.4.2.1.</strong> FFI</a></li><li><a href="../dev/core/new-metric-type/kotlin.html"><strong aria-hidden="true">4.4.2.2.</strong> Kotlin</a></li><li><a href="../dev/core/new-metric-type/swift.html"><strong aria-hidden="true">4.4.2.3.</strong> Swift</a></li></ol></li></ol></li><li><a href="../dev/ffi/index.html"><strong aria-hidden="true">4.5.</strong> FFI Layer</a></li><li><ol class="section"><li><a href="../dev/ffi/when-to-use-what-in-the-ffi.html"><strong aria-hidden="true">4.5.1.</strong> When/How FFI</a></li></ol></li><li><a href="../dev/cut-a-new-release.html"><strong aria-hidden="true">4.6.</strong> Release process</a></li><li><a href="../contributing.html"><strong aria-hidden="true">4.7.</strong> Contributing</a></li><li><ol class="section"><li><a href="../code_coverage.html"><strong aria-hidden="true">4.7.1.</strong> Code coverage</a></li></ol></li><li><a href="../dev/core/internal/index.html"><strong aria-hidden="true">4.8.</strong> Internal implementation details</a></li><li><ol class="section"><li><a href="../dev/core/internal/reserved-ping-names.html"><strong aria-hidden="true">4.8.1.</strong> Reserved ping names</a></li><li><a href="../dev/core/internal/clearing.html"><strong aria-hidden="true">4.8.2.</strong> Clearing metrics when disabling/enabling Glean</a></li><li><a href="../dev/core/internal/payload.html"><strong aria-hidden="true">4.8.3.</strong> Payload format</a></li><li><a href="../dev/core/internal/directory-structure.html"><strong aria-hidden="true">4.8.4.</strong> Directory structure</a></li></ol></li></ol></li><li><a href="../api/index.html"><strong aria-hidden="true">5.</strong> API Documentation</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Glean - Cross-platform Telemetry library</h1>

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#using-the-experiments-api" id="using-the-experiments-api">Using the experiments API</a></h1>
<p>The Glean SDK supports tagging all its pings with experiments annotations. The annotations are useful to report that experiments were active at the time the measurement were collected. The annotations are reported in the optional <code>experiments</code> entry in the <a href="pings/index.html"><code>ping_info</code> section</a> of all the Glean SDK pings.</p>
<blockquote>
<p><strong>Important</strong>: the experiment annotations set through this API are not persisted by the Glean SDK.
The application or consuming library is responsible for setting the relevant experiment annotations at each run.</p>
</blockquote>
<h2><a class="header" href="#api" id="api">API</a></h2>
<pre><code class="language-Kotlin">// Annotate Glean pings with experiments data.
Glean.setExperimentActive(
  experimentId = &quot;blue-button-effective&quot;,
  branch = &quot;branch-with-blue-button&quot;,
  extra: mapOf(
    &quot;buttonLabel&quot; to &quot;test&quot;
  )
)
// After the experiment terminates, the annotation
// can be removed.
Glean.setExperimentInactive(&quot;blue-button-effective&quot;)
</code></pre>
<blockquote>
<p><strong>Important</strong>: Experiment IDs and branch don't need to be pre-defined in the Glean SDK registry files.
Please also note that the <code>extra</code> map is non-nested arbitrary <code>String</code> to <code>String</code> map.</p>
</blockquote>
<p>There are test APIs available too:</p>
<pre><code class="language-Kotlin">import org.mozilla.yourApplication.GleanMetrics.SearchDefault

// Was the experiment annotated in Glean pings?
assertTrue(Glean.testIsExperimentActive(&quot;blue-button-effective&quot;))
// Was the correct branch reported?
assertEquals(
  &quot;branch-with-blue-button&quot;, Glean.testGetExperimentData(&quot;blue-button-effective&quot;)?.branch
)
</code></pre>
<h2><a class="header" href="#limits" id="limits">Limits</a></h2>
<ul>
<li><code>experimentId</code>, <code>branch</code>, and the keys of the 'extra' field are fixed at a maximum length of 30. Length for the values of the <code>extra</code> field is fixed at 50. Longer strings used as ids, keys, or values are truncated to their respective maximum length. For the original Kotlin implementation of the Glean SDK, this is measured in Unicode characters. For the Rust implementation, this is measured in the number of bytes when the string is encoded in UTF-8.</li>
<li><code>extra</code> map is limited to 20 entries. If passed a map which contains more elements than this, it is truncated to 20 elements.  <strong>WARNING</strong> Which items are truncated is nondeterministic due to the unordered nature of maps and what's left may not necessarily be the first elements added.</li>
</ul>
<p><strong>NOTE:</strong> Any truncation that occurs when recording to the Experiments API will result in an <code>invalid_value</code> error being recorded. See <a href="error-reporting.html">Error Reporting</a> for more information about this type of error.</p>
<h2><a class="header" href="#reference" id="reference">Reference</a></h2>
<ul>
<li><a href="../../javadoc/glean/mozilla.telemetry.glean/-glean.html">Kotlin API docs</a>.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../user/error-reporting.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../user/metrics/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../user/error-reporting.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../user/metrics/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="../tabs.js"></script>
        

        

    </body>
</html>
